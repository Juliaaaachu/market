{"ast":null,"code":"'use strict';\n\nfunction Kareem() {\n  this._pres = new Map();\n  this._posts = new Map();\n}\n\nKareem.prototype.execPre = function (name, context, args, callback) {\n  if (arguments.length === 3) {\n    callback = args;\n    args = [];\n  }\n\n  var pres = get(this._pres, name, []);\n  var numPres = pres.length;\n  var numAsyncPres = pres.numAsync || 0;\n  var currentPre = 0;\n  var asyncPresLeft = numAsyncPres;\n  var done = false;\n  var $args = args;\n\n  if (!numPres) {\n    return process.nextTick(function () {\n      callback(null);\n    });\n  }\n\n  var next = function () {\n    if (currentPre >= numPres) {\n      return;\n    }\n\n    var pre = pres[currentPre];\n\n    if (pre.isAsync) {\n      var args = [decorateNextFn(_next), decorateNextFn(function (error) {\n        if (error) {\n          if (done) {\n            return;\n          }\n\n          done = true;\n          return callback(error);\n        }\n\n        if (--asyncPresLeft === 0 && currentPre >= numPres) {\n          return callback(null);\n        }\n      })];\n      callMiddlewareFunction(pre.fn, context, args, args[0]);\n    } else if (pre.fn.length > 0) {\n      var args = [decorateNextFn(_next)];\n\n      var _args = arguments.length >= 2 ? arguments : [null].concat($args);\n\n      for (var i = 1; i < _args.length; ++i) {\n        args.push(_args[i]);\n      }\n\n      callMiddlewareFunction(pre.fn, context, args, args[0]);\n    } else {\n      let error = null;\n      let maybePromise = null;\n\n      try {\n        maybePromise = pre.fn.call(context);\n      } catch (err) {\n        error = err;\n      }\n\n      if (isPromise(maybePromise)) {\n        maybePromise.then(() => _next(), err => _next(err));\n      } else {\n        if (++currentPre >= numPres) {\n          if (asyncPresLeft > 0) {\n            // Leave parallel hooks to run\n            return;\n          } else {\n            return process.nextTick(function () {\n              callback(error);\n            });\n          }\n        }\n\n        next(error);\n      }\n    }\n  };\n\n  next.apply(null, [null].concat(args));\n\n  function _next(error) {\n    if (error) {\n      if (done) {\n        return;\n      }\n\n      done = true;\n      return callback(error);\n    }\n\n    if (++currentPre >= numPres) {\n      if (asyncPresLeft > 0) {\n        // Leave parallel hooks to run\n        return;\n      } else {\n        return callback(null);\n      }\n    }\n\n    next.apply(context, arguments);\n  }\n};\n\nKareem.prototype.execPreSync = function (name, context, args) {\n  var pres = get(this._pres, name, []);\n  var numPres = pres.length;\n\n  for (var i = 0; i < numPres; ++i) {\n    pres[i].fn.apply(context, args || []);\n  }\n};\n\nKareem.prototype.execPost = function (name, context, args, options, callback) {\n  if (arguments.length < 5) {\n    callback = options;\n    options = null;\n  }\n\n  var posts = get(this._posts, name, []);\n  var numPosts = posts.length;\n  var currentPost = 0;\n  var firstError = null;\n\n  if (options && options.error) {\n    firstError = options.error;\n  }\n\n  if (!numPosts) {\n    return process.nextTick(function () {\n      callback.apply(null, [firstError].concat(args));\n    });\n  }\n\n  var next = function () {\n    var post = posts[currentPost].fn;\n    var numArgs = 0;\n    var argLength = args.length;\n    var newArgs = [];\n\n    for (var i = 0; i < argLength; ++i) {\n      numArgs += args[i] && args[i]._kareemIgnore ? 0 : 1;\n\n      if (!args[i] || !args[i]._kareemIgnore) {\n        newArgs.push(args[i]);\n      }\n    }\n\n    if (firstError) {\n      if (post.length === numArgs + 2) {\n        var _cb = decorateNextFn(function (error) {\n          if (error) {\n            firstError = error;\n          }\n\n          if (++currentPost >= numPosts) {\n            return callback.call(null, firstError);\n          }\n\n          next();\n        });\n\n        callMiddlewareFunction(post, context, [firstError].concat(newArgs).concat([_cb]), _cb);\n      } else {\n        if (++currentPost >= numPosts) {\n          return callback.call(null, firstError);\n        }\n\n        next();\n      }\n    } else {\n      const _cb = decorateNextFn(function (error) {\n        if (error) {\n          firstError = error;\n          return next();\n        }\n\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [null].concat(args));\n        }\n\n        next();\n      });\n\n      if (post.length === numArgs + 2) {\n        // Skip error handlers if no error\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [null].concat(args));\n        }\n\n        return next();\n      }\n\n      if (post.length === numArgs + 1) {\n        callMiddlewareFunction(post, context, newArgs.concat([_cb]), _cb);\n      } else {\n        let error;\n        let maybePromise;\n\n        try {\n          maybePromise = post.apply(context, newArgs);\n        } catch (err) {\n          error = err;\n          firstError = err;\n        }\n\n        if (isPromise(maybePromise)) {\n          return maybePromise.then(() => _cb(), err => _cb(err));\n        }\n\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [error].concat(args));\n        }\n\n        next(error);\n      }\n    }\n  };\n\n  next();\n};\n\nKareem.prototype.execPostSync = function (name, context, args) {\n  const posts = get(this._posts, name, []);\n  const numPosts = posts.length;\n\n  for (let i = 0; i < numPosts; ++i) {\n    posts[i].fn.apply(context, args || []);\n  }\n};\n\nKareem.prototype.createWrapperSync = function (name, fn) {\n  var kareem = this;\n  return function syncWrapper() {\n    kareem.execPreSync(name, this, arguments);\n    var toReturn = fn.apply(this, arguments);\n    kareem.execPostSync(name, this, [toReturn]);\n    return toReturn;\n  };\n};\n\nfunction _handleWrapError(instance, error, name, context, args, options, callback) {\n  if (options.useErrorHandlers) {\n    var _options = {\n      error: error\n    };\n    return instance.execPost(name, context, args, _options, function (error) {\n      return typeof callback === 'function' && callback(error);\n    });\n  } else {\n    return typeof callback === 'function' ? callback(error) : undefined;\n  }\n}\n\nKareem.prototype.wrap = function (name, fn, context, args, options) {\n  const lastArg = args.length > 0 ? args[args.length - 1] : null;\n  const argsWithoutCb = typeof lastArg === 'function' ? args.slice(0, args.length - 1) : args;\n\n  const _this = this;\n\n  options = options || {};\n  const checkForPromise = options.checkForPromise;\n  this.execPre(name, context, args, function (error) {\n    if (error) {\n      const numCallbackParams = options.numCallbackParams || 0;\n      const errorArgs = options.contextParameter ? [context] : [];\n\n      for (var i = errorArgs.length; i < numCallbackParams; ++i) {\n        errorArgs.push(null);\n      }\n\n      return _handleWrapError(_this, error, name, context, errorArgs, options, lastArg);\n    }\n\n    const end = typeof lastArg === 'function' ? args.length - 1 : args.length;\n    const numParameters = fn.length;\n    const ret = fn.apply(context, args.slice(0, end).concat(_cb));\n\n    if (checkForPromise) {\n      if (ret != null && typeof ret.then === 'function') {\n        // Thenable, use it\n        return ret.then(res => _cb(null, res), err => _cb(err));\n      } // If `fn()` doesn't have a callback argument and doesn't return a\n      // promise, assume it is sync\n\n\n      if (numParameters < end + 1) {\n        return _cb(null, ret);\n      }\n    }\n\n    function _cb() {\n      const args = arguments;\n      const argsWithoutError = Array.prototype.slice.call(arguments, 1);\n\n      if (options.nullResultByDefault && argsWithoutError.length === 0) {\n        argsWithoutError.push(null);\n      }\n\n      if (arguments[0]) {\n        // Assume error\n        return _handleWrapError(_this, arguments[0], name, context, argsWithoutError, options, lastArg);\n      } else {\n        _this.execPost(name, context, argsWithoutError, function () {\n          if (arguments[0]) {\n            return typeof lastArg === 'function' ? lastArg(arguments[0]) : undefined;\n          }\n\n          return typeof lastArg === 'function' ? lastArg.apply(context, arguments) : undefined;\n        });\n      }\n    }\n  });\n};\n\nKareem.prototype.filter = function (fn) {\n  const clone = this.clone();\n  const pres = Array.from(clone._pres.keys());\n\n  for (const name of pres) {\n    const hooks = this._pres.get(name).map(h => Object.assign({}, h, {\n      name: name\n    })).filter(fn);\n\n    if (hooks.length === 0) {\n      clone._pres.delete(name);\n\n      continue;\n    }\n\n    hooks.numAsync = hooks.filter(h => h.isAsync).length;\n\n    clone._pres.set(name, hooks);\n  }\n\n  const posts = Array.from(clone._posts.keys());\n\n  for (const name of posts) {\n    const hooks = this._posts.get(name).map(h => Object.assign({}, h, {\n      name: name\n    })).filter(fn);\n\n    if (hooks.length === 0) {\n      clone._posts.delete(name);\n\n      continue;\n    }\n\n    clone._posts.set(name, hooks);\n  }\n\n  return clone;\n};\n\nKareem.prototype.hasHooks = function (name) {\n  return this._pres.has(name) || this._posts.has(name);\n};\n\nKareem.prototype.createWrapper = function (name, fn, context, options) {\n  var _this = this;\n\n  if (!this.hasHooks(name)) {\n    // Fast path: if there's no hooks for this function, just return the\n    // function wrapped in a nextTick()\n    return function () {\n      process.nextTick(() => fn.apply(this, arguments));\n    };\n  }\n\n  return function () {\n    var _context = context || this;\n\n    var args = Array.prototype.slice.call(arguments);\n\n    _this.wrap(name, fn, _context, args, options);\n  };\n};\n\nKareem.prototype.pre = function (name, isAsync, fn, error, unshift) {\n  let options = {};\n\n  if (typeof isAsync === 'object' && isAsync != null) {\n    options = isAsync;\n    isAsync = options.isAsync;\n  } else if (typeof arguments[1] !== 'boolean') {\n    error = fn;\n    fn = isAsync;\n    isAsync = false;\n  }\n\n  const pres = get(this._pres, name, []);\n\n  this._pres.set(name, pres);\n\n  if (isAsync) {\n    pres.numAsync = pres.numAsync || 0;\n    ++pres.numAsync;\n  }\n\n  if (typeof fn !== 'function') {\n    throw new Error('pre() requires a function, got \"' + typeof fn + '\"');\n  }\n\n  if (unshift) {\n    pres.unshift(Object.assign({}, options, {\n      fn: fn,\n      isAsync: isAsync\n    }));\n  } else {\n    pres.push(Object.assign({}, options, {\n      fn: fn,\n      isAsync: isAsync\n    }));\n  }\n\n  return this;\n};\n\nKareem.prototype.post = function (name, options, fn, unshift) {\n  const hooks = get(this._posts, name, []);\n\n  if (typeof options === 'function') {\n    unshift = !!fn;\n    fn = options;\n    options = {};\n  }\n\n  if (typeof fn !== 'function') {\n    throw new Error('post() requires a function, got \"' + typeof fn + '\"');\n  }\n\n  if (unshift) {\n    hooks.unshift(Object.assign({}, options, {\n      fn: fn\n    }));\n  } else {\n    hooks.push(Object.assign({}, options, {\n      fn: fn\n    }));\n  }\n\n  this._posts.set(name, hooks);\n\n  return this;\n};\n\nKareem.prototype.clone = function () {\n  const n = new Kareem();\n\n  for (let key of this._pres.keys()) {\n    const clone = this._pres.get(key).slice();\n\n    clone.numAsync = this._pres.get(key).numAsync;\n\n    n._pres.set(key, clone);\n  }\n\n  for (let key of this._posts.keys()) {\n    n._posts.set(key, this._posts.get(key).slice());\n  }\n\n  return n;\n};\n\nKareem.prototype.merge = function (other, clone) {\n  clone = arguments.length === 1 ? true : clone;\n  var ret = clone ? this.clone() : this;\n\n  for (let key of other._pres.keys()) {\n    const sourcePres = get(ret._pres, key, []);\n\n    const deduplicated = other._pres.get(key). // Deduplicate based on `fn`\n    filter(p => sourcePres.map(_p => _p.fn).indexOf(p.fn) === -1);\n\n    const combined = sourcePres.concat(deduplicated);\n    combined.numAsync = sourcePres.numAsync || 0;\n    combined.numAsync += deduplicated.filter(p => p.isAsync).length;\n\n    ret._pres.set(key, combined);\n  }\n\n  for (let key of other._posts.keys()) {\n    const sourcePosts = get(ret._posts, key, []);\n\n    const deduplicated = other._posts.get(key).filter(p => sourcePosts.indexOf(p) === -1);\n\n    ret._posts.set(key, sourcePosts.concat(deduplicated));\n  }\n\n  return ret;\n};\n\nfunction get(map, key, def) {\n  if (map.has(key)) {\n    return map.get(key);\n  }\n\n  return def;\n}\n\nfunction callMiddlewareFunction(fn, context, args, next) {\n  let maybePromise;\n\n  try {\n    maybePromise = fn.apply(context, args);\n  } catch (error) {\n    return next(error);\n  }\n\n  if (isPromise(maybePromise)) {\n    maybePromise.then(() => next(), err => next(err));\n  }\n}\n\nfunction isPromise(v) {\n  return v != null && typeof v.then === 'function';\n}\n\nfunction decorateNextFn(fn) {\n  var called = false;\n\n  var _this = this;\n\n  return function () {\n    // Ensure this function can only be called once\n    if (called) {\n      return;\n    }\n\n    called = true; // Make sure to clear the stack so try/catch doesn't catch errors\n    // in subsequent middleware\n\n    return process.nextTick(() => fn.apply(_this, arguments));\n  };\n}\n\nmodule.exports = Kareem;","map":{"version":3,"names":["Kareem","_pres","Map","_posts","prototype","execPre","name","context","args","callback","arguments","length","pres","get","numPres","numAsyncPres","numAsync","currentPre","asyncPresLeft","done","$args","process","nextTick","next","pre","isAsync","decorateNextFn","_next","error","callMiddlewareFunction","fn","_args","concat","i","push","maybePromise","call","err","isPromise","then","apply","execPreSync","execPost","options","posts","numPosts","currentPost","firstError","post","numArgs","argLength","newArgs","_kareemIgnore","_cb","execPostSync","createWrapperSync","kareem","syncWrapper","toReturn","_handleWrapError","instance","useErrorHandlers","_options","undefined","wrap","lastArg","argsWithoutCb","slice","_this","checkForPromise","numCallbackParams","errorArgs","contextParameter","end","numParameters","ret","res","argsWithoutError","Array","nullResultByDefault","filter","clone","from","keys","hooks","map","h","Object","assign","delete","set","hasHooks","has","createWrapper","_context","unshift","Error","n","key","merge","other","sourcePres","deduplicated","p","_p","indexOf","combined","sourcePosts","def","v","called","module","exports"],"sources":["/Users/juliachu/Dropbox/CS/market/node_modules/kareem/index.js"],"sourcesContent":["'use strict';\n\nfunction Kareem() {\n  this._pres = new Map();\n  this._posts = new Map();\n}\n\nKareem.prototype.execPre = function(name, context, args, callback) {\n  if (arguments.length === 3) {\n    callback = args;\n    args = [];\n  }\n  var pres = get(this._pres, name, []);\n  var numPres = pres.length;\n  var numAsyncPres = pres.numAsync || 0;\n  var currentPre = 0;\n  var asyncPresLeft = numAsyncPres;\n  var done = false;\n  var $args = args;\n\n  if (!numPres) {\n    return process.nextTick(function() {\n      callback(null);\n    });\n  }\n\n  var next = function() {\n    if (currentPre >= numPres) {\n      return;\n    }\n    var pre = pres[currentPre];\n\n    if (pre.isAsync) {\n      var args = [\n        decorateNextFn(_next),\n        decorateNextFn(function(error) {\n          if (error) {\n            if (done) {\n              return;\n            }\n            done = true;\n            return callback(error);\n          }\n          if (--asyncPresLeft === 0 && currentPre >= numPres) {\n            return callback(null);\n          }\n        })\n      ];\n\n      callMiddlewareFunction(pre.fn, context, args, args[0]);\n    } else if (pre.fn.length > 0) {\n      var args = [decorateNextFn(_next)];\n      var _args = arguments.length >= 2 ? arguments : [null].concat($args);\n      for (var i = 1; i < _args.length; ++i) {\n        args.push(_args[i]);\n      }\n\n      callMiddlewareFunction(pre.fn, context, args, args[0]);\n    } else {\n      let error = null;\n      let maybePromise = null;\n      try {\n        maybePromise = pre.fn.call(context);\n      } catch (err) {\n        error = err;\n      }\n\n      if (isPromise(maybePromise)) {\n        maybePromise.then(() => _next(), err => _next(err));\n      } else {\n        if (++currentPre >= numPres) {\n          if (asyncPresLeft > 0) {\n            // Leave parallel hooks to run\n            return;\n          } else {\n            return process.nextTick(function() {\n              callback(error);\n            });\n          }\n        }\n        next(error);\n      }\n    }\n  };\n\n  next.apply(null, [null].concat(args));\n\n  function _next(error) {\n    if (error) {\n      if (done) {\n        return;\n      }\n      done = true;\n      return callback(error);\n    }\n\n    if (++currentPre >= numPres) {\n      if (asyncPresLeft > 0) {\n        // Leave parallel hooks to run\n        return;\n      } else {\n        return callback(null);\n      }\n    }\n\n    next.apply(context, arguments);\n  }\n};\n\nKareem.prototype.execPreSync = function(name, context, args) {\n  var pres = get(this._pres, name, []);\n  var numPres = pres.length;\n\n  for (var i = 0; i < numPres; ++i) {\n    pres[i].fn.apply(context, args || []);\n  }\n};\n\nKareem.prototype.execPost = function(name, context, args, options, callback) {\n  if (arguments.length < 5) {\n    callback = options;\n    options = null;\n  }\n  var posts = get(this._posts, name, []);\n  var numPosts = posts.length;\n  var currentPost = 0;\n\n  var firstError = null;\n  if (options && options.error) {\n    firstError = options.error;\n  }\n\n  if (!numPosts) {\n    return process.nextTick(function() {\n      callback.apply(null, [firstError].concat(args));\n    });\n  }\n\n  var next = function() {\n    var post = posts[currentPost].fn;\n    var numArgs = 0;\n    var argLength = args.length;\n    var newArgs = [];\n    for (var i = 0; i < argLength; ++i) {\n      numArgs += args[i] && args[i]._kareemIgnore ? 0 : 1;\n      if (!args[i] || !args[i]._kareemIgnore) {\n        newArgs.push(args[i]);\n      }\n    }\n\n    if (firstError) {\n      if (post.length === numArgs + 2) {\n        var _cb = decorateNextFn(function(error) {\n          if (error) {\n            firstError = error;\n          }\n          if (++currentPost >= numPosts) {\n            return callback.call(null, firstError);\n          }\n          next();\n        });\n\n        callMiddlewareFunction(post, context,\n          [firstError].concat(newArgs).concat([_cb]), _cb);\n      } else {\n        if (++currentPost >= numPosts) {\n          return callback.call(null, firstError);\n        }\n        next();\n      }\n    } else {\n      const _cb = decorateNextFn(function(error) {\n        if (error) {\n          firstError = error;\n          return next();\n        }\n\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [null].concat(args));\n        }\n\n        next();\n      });\n\n      if (post.length === numArgs + 2) {\n        // Skip error handlers if no error\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [null].concat(args));\n        }\n        return next();\n      }\n      if (post.length === numArgs + 1) {\n        callMiddlewareFunction(post, context, newArgs.concat([_cb]), _cb);\n      } else {\n        let error;\n        let maybePromise;\n        try {\n          maybePromise = post.apply(context, newArgs);\n        } catch (err) {\n          error = err;\n          firstError = err;\n        }\n\n        if (isPromise(maybePromise)) {\n          return maybePromise.then(() => _cb(), err => _cb(err));\n        }\n\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [error].concat(args));\n        }\n\n        next(error);\n      }\n    }\n  };\n\n  next();\n};\n\nKareem.prototype.execPostSync = function(name, context, args) {\n  const posts = get(this._posts, name, []);\n  const numPosts = posts.length;\n\n  for (let i = 0; i < numPosts; ++i) {\n    posts[i].fn.apply(context, args || []);\n  }\n};\n\nKareem.prototype.createWrapperSync = function(name, fn) {\n  var kareem = this;\n  return function syncWrapper() {\n    kareem.execPreSync(name, this, arguments);\n\n    var toReturn = fn.apply(this, arguments);\n\n    kareem.execPostSync(name, this, [toReturn]);\n\n    return toReturn;\n  };\n}\n\nfunction _handleWrapError(instance, error, name, context, args, options, callback) {\n  if (options.useErrorHandlers) {\n    var _options = { error: error };\n    return instance.execPost(name, context, args, _options, function(error) {\n      return typeof callback === 'function' && callback(error);\n    });\n  } else {\n    return typeof callback === 'function' ?\n      callback(error) :\n      undefined;\n  }\n}\n\nKareem.prototype.wrap = function(name, fn, context, args, options) {\n  const lastArg = (args.length > 0 ? args[args.length - 1] : null);\n  const argsWithoutCb = typeof lastArg === 'function' ?\n    args.slice(0, args.length - 1) :\n    args;\n  const _this = this;\n\n  options = options || {};\n  const checkForPromise = options.checkForPromise;\n\n  this.execPre(name, context, args, function(error) {\n    if (error) {\n      const numCallbackParams = options.numCallbackParams || 0;\n      const errorArgs = options.contextParameter ? [context] : [];\n      for (var i = errorArgs.length; i < numCallbackParams; ++i) {\n        errorArgs.push(null);\n      }\n      return _handleWrapError(_this, error, name, context, errorArgs,\n        options, lastArg);\n    }\n\n    const end = (typeof lastArg === 'function' ? args.length - 1 : args.length);\n    const numParameters = fn.length;\n    const ret = fn.apply(context, args.slice(0, end).concat(_cb));\n\n    if (checkForPromise) {\n      if (ret != null && typeof ret.then === 'function') {\n        // Thenable, use it\n        return ret.then(\n          res => _cb(null, res),\n          err => _cb(err)\n        );\n      }\n\n      // If `fn()` doesn't have a callback argument and doesn't return a\n      // promise, assume it is sync\n      if (numParameters < end + 1) {\n        return _cb(null, ret);\n      }\n    }\n\n    function _cb() {\n      const args = arguments;\n      const argsWithoutError = Array.prototype.slice.call(arguments, 1);\n      if (options.nullResultByDefault && argsWithoutError.length === 0) {\n        argsWithoutError.push(null);\n      }\n      if (arguments[0]) {\n        // Assume error\n        return _handleWrapError(_this, arguments[0], name, context,\n          argsWithoutError, options, lastArg);\n      } else {\n        _this.execPost(name, context, argsWithoutError, function() {\n          if (arguments[0]) {\n            return typeof lastArg === 'function' ?\n              lastArg(arguments[0]) :\n              undefined;\n          }\n\n          return typeof lastArg === 'function' ?\n            lastArg.apply(context, arguments) :\n            undefined;\n        });\n      }\n    }\n  });\n};\n\nKareem.prototype.filter = function(fn) {\n  const clone = this.clone();\n\n  const pres = Array.from(clone._pres.keys());\n  for (const name of pres) {\n    const hooks = this._pres.get(name).\n      map(h => Object.assign({}, h, { name: name })).\n      filter(fn);\n\n    if (hooks.length === 0) {\n      clone._pres.delete(name);\n      continue;\n    }\n\n    hooks.numAsync = hooks.filter(h => h.isAsync).length;\n\n    clone._pres.set(name, hooks);\n  }\n\n  const posts = Array.from(clone._posts.keys());\n  for (const name of posts) {\n    const hooks = this._posts.get(name).\n      map(h => Object.assign({}, h, { name: name })).\n      filter(fn);\n\n    if (hooks.length === 0) {\n      clone._posts.delete(name);\n      continue;\n    }\n\n    clone._posts.set(name, hooks);\n  }\n\n  return clone;\n};\n\nKareem.prototype.hasHooks = function(name) {\n  return this._pres.has(name) || this._posts.has(name);\n};\n\nKareem.prototype.createWrapper = function(name, fn, context, options) {\n  var _this = this;\n  if (!this.hasHooks(name)) {\n    // Fast path: if there's no hooks for this function, just return the\n    // function wrapped in a nextTick()\n    return function() {\n      process.nextTick(() => fn.apply(this, arguments));\n    };\n  }\n  return function() {\n    var _context = context || this;\n    var args = Array.prototype.slice.call(arguments);\n    _this.wrap(name, fn, _context, args, options);\n  };\n};\n\nKareem.prototype.pre = function(name, isAsync, fn, error, unshift) {\n  let options = {};\n  if (typeof isAsync === 'object' && isAsync != null) {\n    options = isAsync;\n    isAsync = options.isAsync;\n  } else if (typeof arguments[1] !== 'boolean') {\n    error = fn;\n    fn = isAsync;\n    isAsync = false;\n  }\n\n  const pres = get(this._pres, name, []);\n  this._pres.set(name, pres);\n\n  if (isAsync) {\n    pres.numAsync = pres.numAsync || 0;\n    ++pres.numAsync;\n  }\n\n  if (typeof fn !== 'function') {\n    throw new Error('pre() requires a function, got \"' + typeof fn + '\"');\n  }\n\n  if (unshift) {\n    pres.unshift(Object.assign({}, options, { fn: fn, isAsync: isAsync }));\n  } else {\n    pres.push(Object.assign({}, options, { fn: fn, isAsync: isAsync }));\n  }\n\n  return this;\n};\n\nKareem.prototype.post = function(name, options, fn, unshift) {\n  const hooks = get(this._posts, name, []);\n\n  if (typeof options === 'function') {\n    unshift = !!fn;\n    fn = options;\n    options = {};\n  }\n\n  if (typeof fn !== 'function') {\n    throw new Error('post() requires a function, got \"' + typeof fn + '\"');\n  }\n\n  if (unshift) {\n    hooks.unshift(Object.assign({}, options, { fn: fn }));\n  } else {\n    hooks.push(Object.assign({}, options, { fn: fn }));\n  }\n  this._posts.set(name, hooks);\n  return this;\n};\n\nKareem.prototype.clone = function() {\n  const n = new Kareem();\n\n  for (let key of this._pres.keys()) {\n    const clone = this._pres.get(key).slice();\n    clone.numAsync = this._pres.get(key).numAsync;\n    n._pres.set(key, clone);\n  }\n  for (let key of this._posts.keys()) {\n    n._posts.set(key, this._posts.get(key).slice());\n  }\n\n  return n;\n};\n\nKareem.prototype.merge = function(other, clone) {\n  clone = arguments.length === 1 ? true : clone;\n  var ret = clone ? this.clone() : this;\n\n  for (let key of other._pres.keys()) {\n    const sourcePres = get(ret._pres, key, []);\n    const deduplicated = other._pres.get(key).\n      // Deduplicate based on `fn`\n      filter(p => sourcePres.map(_p => _p.fn).indexOf(p.fn) === -1);\n    const combined = sourcePres.concat(deduplicated);\n    combined.numAsync = sourcePres.numAsync || 0;\n    combined.numAsync += deduplicated.filter(p => p.isAsync).length;\n    ret._pres.set(key, combined);\n  }\n  for (let key of other._posts.keys()) {\n    const sourcePosts = get(ret._posts, key, []);\n    const deduplicated = other._posts.get(key).\n      filter(p => sourcePosts.indexOf(p) === -1);\n    ret._posts.set(key, sourcePosts.concat(deduplicated));\n  }\n\n  return ret;\n};\n\nfunction get(map, key, def) {\n  if (map.has(key)) {\n    return map.get(key);\n  }\n  return def;\n}\n\nfunction callMiddlewareFunction(fn, context, args, next) {\n  let maybePromise;\n  try {\n    maybePromise = fn.apply(context, args);\n  } catch (error) {\n    return next(error);\n  }\n\n  if (isPromise(maybePromise)) {\n    maybePromise.then(() => next(), err => next(err));\n  }\n}\n\nfunction isPromise(v) {\n  return v != null && typeof v.then === 'function';\n}\n\nfunction decorateNextFn(fn) {\n  var called = false;\n  var _this = this;\n  return function() {\n    // Ensure this function can only be called once\n    if (called) {\n      return;\n    }\n    called = true;\n    // Make sure to clear the stack so try/catch doesn't catch errors\n    // in subsequent middleware\n    return process.nextTick(() => fn.apply(_this, arguments));\n  };\n}\n\nmodule.exports = Kareem;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}