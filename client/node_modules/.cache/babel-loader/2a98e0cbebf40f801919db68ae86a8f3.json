{"ast":null,"code":"'use strict';\n\nconst documentSchemaSymbol = require('../../helpers/symbols').documentSchemaSymbol;\n\nconst get = require('../../helpers/get');\n\nconst internalToObjectOptions = require('../../options').internalToObjectOptions;\n\nconst utils = require('../../utils');\n\nlet Document;\n\nconst getSymbol = require('../../helpers/symbols').getSymbol;\n\nconst scopeSymbol = require('../../helpers/symbols').scopeSymbol;\n/*!\n * exports\n */\n\n\nexports.compile = compile;\nexports.defineKey = defineKey;\n/*!\n * Compiles schemas.\n */\n\nfunction compile(tree, proto, prefix, options) {\n  Document = Document || require('../../document');\n  const keys = Object.keys(tree);\n  const len = keys.length;\n  let limb;\n  let key;\n\n  for (let i = 0; i < len; ++i) {\n    key = keys[i];\n    limb = tree[key];\n    const hasSubprops = utils.isPOJO(limb) && Object.keys(limb).length && (!limb[options.typeKey] || options.typeKey === 'type' && limb.type.type);\n    const subprops = hasSubprops ? limb : null;\n    defineKey(key, subprops, proto, prefix, keys, options);\n  }\n}\n/*!\n * Defines the accessor named prop on the incoming prototype.\n */\n\n\nfunction defineKey(prop, subprops, prototype, prefix, keys, options) {\n  Document = Document || require('../../document');\n  const path = (prefix ? prefix + '.' : '') + prop;\n  prefix = prefix || '';\n\n  if (subprops) {\n    Object.defineProperty(prototype, prop, {\n      enumerable: true,\n      configurable: true,\n      get: function () {\n        const _this = this;\n\n        if (!this.$__.getters) {\n          this.$__.getters = {};\n        }\n\n        if (!this.$__.getters[path]) {\n          const nested = Object.create(Document.prototype, getOwnPropertyDescriptors(this)); // save scope for nested getters/setters\n\n          if (!prefix) {\n            nested.$__[scopeSymbol] = this;\n          }\n\n          nested.$__.nestedPath = path;\n          Object.defineProperty(nested, 'schema', {\n            enumerable: false,\n            configurable: true,\n            writable: false,\n            value: prototype.schema\n          });\n          Object.defineProperty(nested, documentSchemaSymbol, {\n            enumerable: false,\n            configurable: true,\n            writable: false,\n            value: prototype.schema\n          });\n          Object.defineProperty(nested, 'toObject', {\n            enumerable: false,\n            configurable: true,\n            writable: false,\n            value: function () {\n              return utils.clone(_this.get(path, null, {\n                virtuals: get(this, 'schema.options.toObject.virtuals', null)\n              }));\n            }\n          });\n          Object.defineProperty(nested, 'toJSON', {\n            enumerable: false,\n            configurable: true,\n            writable: false,\n            value: function () {\n              return _this.get(path, null, {\n                virtuals: get(_this, 'schema.options.toJSON.virtuals', null)\n              });\n            }\n          });\n          Object.defineProperty(nested, '$__isNested', {\n            enumerable: false,\n            configurable: true,\n            writable: false,\n            value: true\n          });\n\n          const _isEmptyOptions = Object.freeze({\n            minimize: true,\n            virtuals: false,\n            getters: false,\n            transform: false\n          });\n\n          Object.defineProperty(nested, '$isEmpty', {\n            enumerable: false,\n            configurable: true,\n            writable: false,\n            value: function () {\n              return Object.keys(this.get(path, null, _isEmptyOptions) || {}).length === 0;\n            }\n          });\n          Object.defineProperty(nested, '$__parent', {\n            enumerable: false,\n            configurable: true,\n            writable: false,\n            value: this\n          });\n          compile(subprops, nested, path, options);\n          this.$__.getters[path] = nested;\n        }\n\n        return this.$__.getters[path];\n      },\n      set: function (v) {\n        if (v != null && v.$__isNested) {\n          // Convert top-level to POJO, but leave subdocs hydrated so `$set`\n          // can handle them. See gh-9293.\n          v = v.$__parent.get(path);\n        } else if (v instanceof Document && !v.$__isNested) {\n          v = v.toObject(internalToObjectOptions);\n        }\n\n        const doc = this.$__[scopeSymbol] || this;\n        doc.$set(path, v);\n      }\n    });\n  } else {\n    Object.defineProperty(prototype, prop, {\n      enumerable: true,\n      configurable: true,\n      get: function () {\n        return this[getSymbol].call(this.$__[scopeSymbol] || this, path);\n      },\n      set: function (v) {\n        this.$set.call(this.$__[scopeSymbol] || this, path, v);\n      }\n    });\n  }\n} // gets descriptors for all properties of `object`\n// makes all properties non-enumerable to match previous behavior to #2211\n\n\nfunction getOwnPropertyDescriptors(object) {\n  const result = {};\n  Object.getOwnPropertyNames(object).forEach(function (key) {\n    result[key] = Object.getOwnPropertyDescriptor(object, key); // Assume these are schema paths, ignore them re: #5470\n\n    if (result[key].get) {\n      delete result[key];\n      return;\n    }\n\n    result[key].enumerable = ['isNew', '$__', 'errors', '_doc', '$locals', '$op', '__parentArray', '__index', '$isDocumentArrayElement'].indexOf(key) === -1;\n  });\n  return result;\n}","map":{"version":3,"names":["documentSchemaSymbol","require","get","internalToObjectOptions","utils","Document","getSymbol","scopeSymbol","exports","compile","defineKey","tree","proto","prefix","options","keys","Object","len","length","limb","key","i","hasSubprops","isPOJO","typeKey","type","subprops","prop","prototype","path","defineProperty","enumerable","configurable","_this","$__","getters","nested","create","getOwnPropertyDescriptors","nestedPath","writable","value","schema","clone","virtuals","_isEmptyOptions","freeze","minimize","transform","set","v","$__isNested","$__parent","toObject","doc","$set","call","object","result","getOwnPropertyNames","forEach","getOwnPropertyDescriptor","indexOf"],"sources":["/Users/juliachu/Dropbox/CS/market/node_modules/mongoose/lib/helpers/document/compile.js"],"sourcesContent":["'use strict';\n\nconst documentSchemaSymbol = require('../../helpers/symbols').documentSchemaSymbol;\nconst get = require('../../helpers/get');\nconst internalToObjectOptions = require('../../options').internalToObjectOptions;\nconst utils = require('../../utils');\n\nlet Document;\nconst getSymbol = require('../../helpers/symbols').getSymbol;\nconst scopeSymbol = require('../../helpers/symbols').scopeSymbol;\n\n/*!\n * exports\n */\n\nexports.compile = compile;\nexports.defineKey = defineKey;\n\n/*!\n * Compiles schemas.\n */\n\nfunction compile(tree, proto, prefix, options) {\n  Document = Document || require('../../document');\n  const keys = Object.keys(tree);\n  const len = keys.length;\n  let limb;\n  let key;\n\n  for (let i = 0; i < len; ++i) {\n    key = keys[i];\n    limb = tree[key];\n\n    const hasSubprops = utils.isPOJO(limb) && Object.keys(limb).length &&\n      (!limb[options.typeKey] || (options.typeKey === 'type' && limb.type.type));\n    const subprops = hasSubprops ? limb : null;\n\n    defineKey(key, subprops, proto, prefix, keys, options);\n  }\n}\n\n/*!\n * Defines the accessor named prop on the incoming prototype.\n */\n\nfunction defineKey(prop, subprops, prototype, prefix, keys, options) {\n  Document = Document || require('../../document');\n  const path = (prefix ? prefix + '.' : '') + prop;\n  prefix = prefix || '';\n\n  if (subprops) {\n    Object.defineProperty(prototype, prop, {\n      enumerable: true,\n      configurable: true,\n      get: function() {\n        const _this = this;\n        if (!this.$__.getters) {\n          this.$__.getters = {};\n        }\n\n        if (!this.$__.getters[path]) {\n          const nested = Object.create(Document.prototype, getOwnPropertyDescriptors(this));\n\n          // save scope for nested getters/setters\n          if (!prefix) {\n            nested.$__[scopeSymbol] = this;\n          }\n          nested.$__.nestedPath = path;\n\n          Object.defineProperty(nested, 'schema', {\n            enumerable: false,\n            configurable: true,\n            writable: false,\n            value: prototype.schema\n          });\n\n          Object.defineProperty(nested, documentSchemaSymbol, {\n            enumerable: false,\n            configurable: true,\n            writable: false,\n            value: prototype.schema\n          });\n\n          Object.defineProperty(nested, 'toObject', {\n            enumerable: false,\n            configurable: true,\n            writable: false,\n            value: function() {\n              return utils.clone(_this.get(path, null, {\n                virtuals: get(this, 'schema.options.toObject.virtuals', null)\n              }));\n            }\n          });\n\n          Object.defineProperty(nested, 'toJSON', {\n            enumerable: false,\n            configurable: true,\n            writable: false,\n            value: function() {\n              return _this.get(path, null, {\n                virtuals: get(_this, 'schema.options.toJSON.virtuals', null)\n              });\n            }\n          });\n\n          Object.defineProperty(nested, '$__isNested', {\n            enumerable: false,\n            configurable: true,\n            writable: false,\n            value: true\n          });\n\n          const _isEmptyOptions = Object.freeze({\n            minimize: true,\n            virtuals: false,\n            getters: false,\n            transform: false\n          });\n          Object.defineProperty(nested, '$isEmpty', {\n            enumerable: false,\n            configurable: true,\n            writable: false,\n            value: function() {\n              return Object.keys(this.get(path, null, _isEmptyOptions) || {}).length === 0;\n            }\n          });\n\n          Object.defineProperty(nested, '$__parent', {\n            enumerable: false,\n            configurable: true,\n            writable: false,\n            value: this\n          });\n\n          compile(subprops, nested, path, options);\n          this.$__.getters[path] = nested;\n        }\n\n        return this.$__.getters[path];\n      },\n      set: function(v) {\n        if (v != null && v.$__isNested) {\n          // Convert top-level to POJO, but leave subdocs hydrated so `$set`\n          // can handle them. See gh-9293.\n          v = v.$__parent.get(path);\n        } else if (v instanceof Document && !v.$__isNested) {\n          v = v.toObject(internalToObjectOptions);\n        }\n        const doc = this.$__[scopeSymbol] || this;\n        doc.$set(path, v);\n      }\n    });\n  } else {\n    Object.defineProperty(prototype, prop, {\n      enumerable: true,\n      configurable: true,\n      get: function() {\n        return this[getSymbol].call(this.$__[scopeSymbol] || this, path);\n      },\n      set: function(v) {\n        this.$set.call(this.$__[scopeSymbol] || this, path, v);\n      }\n    });\n  }\n}\n\n// gets descriptors for all properties of `object`\n// makes all properties non-enumerable to match previous behavior to #2211\nfunction getOwnPropertyDescriptors(object) {\n  const result = {};\n\n  Object.getOwnPropertyNames(object).forEach(function(key) {\n    result[key] = Object.getOwnPropertyDescriptor(object, key);\n    // Assume these are schema paths, ignore them re: #5470\n    if (result[key].get) {\n      delete result[key];\n      return;\n    }\n    result[key].enumerable = [\n      'isNew',\n      '$__',\n      'errors',\n      '_doc',\n      '$locals',\n      '$op',\n      '__parentArray',\n      '__index',\n      '$isDocumentArrayElement'\n    ].indexOf(key) === -1;\n  });\n\n  return result;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}